<!doctype html>
<html lang="en" ng-app="spendPlan">
  <head>
    <title>SpendPlan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css"	>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="assets/css/spendplan.css">
    <link rel="apple-touch-icon" sizes="120x120" href="apple-touch-icon.png">
    <script src="https://code.jquery.com/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="assets/jquery-ui/js/jquery-ui-1.10.4.custom.min.js" type="text/javascript"></script>
    <script src="assets/jquery.csv-0.71.min.js" type="text/javascript"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    
    <script src="https://www.dropbox.com/static/api/dropbox-datastores-1.0-latest.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://www.dropbox.com/static/api/1/dropins.js" id="dropboxjs" data-app-key="i86ppgkz7etf1vk"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.7/angular.min.js"></script>
    <script src="assets/dropstore-ng.js"></script>
    <script src="assets/app.js"></script>
  </head>
  <body ng-controller="SpendPlanCtrl">
    <div class="container">
      <div class="page-header">
	<span class="pull-right">
	  <button class="btn btn-default" data-toggle="modal" data-target="#helpModal">
	    Help
	  </button>
	  
	</span>
	<h1>SpendPlan</h1>
      </div>
      <div class="row">
	<div class="col-sm-4">
	  <h2>Accounts</h2>
	  <div style="margin-bottom:.25em">
	    <input type="date"
		   placeholder="mm/dd/yyyy"
		   ng-model="acctDate.date" >
	  </div>
	  <div style="max-height:500px;overflow-y:auto;">
	    <table class="table table-responsive table-striped">
	      <tr ng-repeat="account in accounts">
		<td>{{ account.name }} ({{ account.currency }})</td>
		<td>{{ account.balance | currency:account.currency_symbol }}</td>
	      </tr>
	      <tr>
		<td>
	  	  <input type="text"
	  		 placeholder="New Account"
	  		 style="width:10em"
	  		 ng-model="newAcct.name"> 
		  <select ng-model="newAcct.curr" style="width:4em">
	  	    <option value="GBP">GBP</option>
	  	    <option value="USD">USD</option>
		  </select>
		</td>
		<td>
		  <button ng-click="addAccount()" class="btn btn-default">Add</button>
		</td>
	      </tr>
	    </table>
	  </div>
	</div>
	
	<div class="col-sm-4" >
	  <h2>Categories</h2>
	  <div style="margin-bottom:.25em">
	    <input type="date"
		   placeholder="mm/dd/yyyy"
		   ng-model="catDate.start" >
	    -
	    <input type="date"
		   placeholder="mm/dd/yyyy"
		   ng-model="catDate.end" >
	  </div>
	  <div style="max-height:500px;overflow-y:auto;">
	    <table class="table table-responsive table-striped">
	      <tr ng-repeat="(category,balance) in categories">
		<td>{{ category }}</td>
		<td>{{ balance | currency}}</td>
	      </tr>
	    </table>
	  </div>
	</div>

	<div class="col-sm-4" >
	  <h2>Tags</h2>
	  <div style="margin-bottom:.25em">
	    <input type="date"
		   placeholder="mm/dd/yyyy"
		   ng-model="tagDate.start" >
	    -
	    <input type="date"
		   placeholder="mm/dd/yyyy"
		   ng-model="tagDate.end" >
	  </div>
	  <div style="max-height:500px;overflow-y:auto;">
	    <table class="table table-responsive table-striped">
	      <tr ng-repeat="(tag,balance) in tags">
		<td>{{ tag }}</td>
		<td>{{ balance | currency}}</td>
	      </tr>
	    </table>
	  </div>
	</div>
	
      </div> <!-- row -->
      
      <div class="row">
	<div class="col-md-2 col-md-push-10">
	  <h2>Filters</h2>
	  <form name="filterForm">
	  <h5>Date Range</h5>
	  <input type="date" 
		 placeholder="mm/dd/yyyy" 
		 ng-model="trans_filter.date_min" >
	  <input type="date"
		 placeholder="mm/dd/yyyy"
		 ng-model="trans_filter.date_max" >
	  <h5>Amount</h5>
	  <input type="text"
		 style="width:4em"
		 ng-model="trans_filter.amount_min"
		 placeholder="min">
	  -
	  <input type="text"
		 style="width:4em"
		 ng-model="trans_filter.amount_max"
		 placeholder="max">
	  <h5>Category</h5>
	  <input type="text"
		 ng-model="trans_filter.category">
	  <h5>Account</h5>
	  <input type="text"
		 ng-model="trans_filter.account" >
	  <h5>Tags</h5>
	  <input type="text"
		 ng-model="trans_filter.tags">
	  <h5>Note</h5>
	  <input type="text"
		 ng-model="trans_filter.note">
	  </form>
	  <!-- {{ trans_filter | json }} -->
	</div>
	
	<div class="col-md-10 col-md-pull-2">
	  <div style="float:right">
	    <span db-chooser></span>
	    <span file-chooser></span>
	  </div>
	  <h2>Transactions</h2>
	  <div style="max-height:700px;overflow-y:auto;">
	    <table class="table table-responsive table-condensed" id="trans-table">
	      <tbody>
		<tr style="background-color:rgba(200,220,255,0.3)">
		  <td>
		    <input type="date"
			   style="width:8em"
	  		   placeholder="MM/DD/YYYY"
	  		   ng-model="newTrans.date">
		  </td>
		  <td>
		    <input type="text"
			   style="width:4em"
	  		   placeholder="XX.XX"
	  		   ng-model="newTrans.amount">
		  </td>
		  <td>
		    <input type="text"
			   style="width:7em"
	  		   placeholder="Category"
	  		   ng-model="newTrans.category">
		  </td>
		  <td>
		    <input type="text"
	  		   placeholder="Tags"
	  		   style="width:15em"
	  		   ng-model="newTrans.tags">
		  </td>
		  <td>
		    <select ng-model="newTrans.account"
	  		    ng-options="a.name + ' (' + a.currency + ')' for a in accounts">
		    </select>
		  </td>
		  <td>
		    <span ng-click="addTransaction()" class="glyphicon glyphicon-plus"></span>
		  </td>
		</tr>
		<tr style="background-color:rgba(200,220,255,0.3)">
		  <td colspan="2">
		    <strong>Add New</strong>
		  </td>
		  <td colspan="4">
		    <input type="text"
	  		   style="width:45em"
	  		   placeholder="Note"
	  		   ng-model="newTrans.note">
		  </td>
		</tr>
		
		<tr ng-repeat-start="transaction in filteredTransactions" >
		  <td rowspan="2">{{ transaction.date | date:'shortDate' }}</td>
		  <td rowspan="2" class="{{ transaction.color }}">
		    {{ transaction.amount | currency:transaction.currency_symbol }}
		    <span ng-if="transaction.currency == 'GBP'">
		      <br>{{ transaction.amount/ exchangeRates[transaction.date] | currency }}
		    </span>
		  </td>
		  <td ng-class="{ editing: transaction == edit_category.tran }">
		    <span class="view" 
			  ng-dblclick="startEdit(transaction,'edit_category')">
		      {{ transaction.category | empty }}
		    </span>
		    <span class="edit" ng-if="thisIsIt(transaction,'edit_category')">
		      <input type="text" 
			     ng-model="edit_category.repl" 
			     ng-blur="editCategory(transaction)">
		    </span>
		  </td>
		  <td ng-class="{ editing: transaction == edit_tags.tran }"
		      ng-dblclick="startEdit(transaction,'edit_tags')">
		    <strong>Tags</strong>:
		    <span ng-repeat="tag in transaction.tags"
	      		  class="view">
	      	      <span class="label label-default">{{ tag }}</span>
		    </span>
		    <span class="edit" ng-if="thisIsIt(transaction,'edit_tags')">
	      	      <input type="text"
	      		     ng-model="edit_tags.repl"
	      		     ng-blur="editTags(transaction)">
		    </span>
		  </td>
		  <td>{{ transaction.acct }}
		    ({{ transaction.currency }})</td>
		  <td>
		    <span class="glyphicon glyphicon-remove"
			  ng-click="transaction.trans.deleteRecord()">
		    </span>
		  </td>
		</tr>
		<tr ng-repeat-end>
		  <td colspan="4"
		      ng-class="{ editing: transaction == edit_note.tran }">
		    <span class="view" ng-dblclick="startEdit(transaction,'edit_note')">
		      <strong>For</strong>: {{ transaction.note | empty }}
		    </span>
		    <span class="edit" ng-if="thisIsIt(transaction,'edit_note')">
		      <input type="text" 
			     ng-model="edit_note.repl" 
			     ng-blur="editNote(transaction)">
		    </span>
		  </td>
		</tr>
	      </tbody>
	    </table>
	  </div> <!-- scroll div -->
	</div> <!-- col-md-10 -->
      </div> <!-- row -->

      <div class="modal fade" id="importModal" tabindex="-1" role="dialog">
	<div class="modal-dialog">
	  <div class="modal-content">
	    <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="importModalLabel">Import</h4>
	    </div>
	    <div class="modal-body" style="max-height:600px;overflow:auto">
	      <div>
		Account: <select ng-model="newTransactions.account"
	  			 ng-options="a.name + ' (' + a.currency + ')' for a in accounts">
		</select>
	      </div>
	      <div>
		Date Format: <input type="text" ng-model="newTransactions.date_fmt">
	      </div>
	      <div>
		Invert Amounts? <input type="checkbox" 
				       ng-model="newTransactions.debits_negative"
				       ng-true-value="-1"
				       ng-false-value="1" >
	      </div>
	      <table class="table table-condensed"> 
		<tr>
		  <td><!-- Placeholder for delete in rows--></td>
		  <td ng-repeat="c in newTransactions.cols track by $index">
		    <select ng-model="newTransactions.cols[$index]"
			    ng-options="c_hdr for c_hdr in column_headers">
		    </select>
		  </td>
		</tr>
		<tr ng-repeat="t in newTransactions.data track by $index">
		  <td>
		    <span class="glyphicon glyphicon-remove"
			  ng-click="newTransactions.data.splice($index,1)">
		  </td>
		  <td ng-repeat="x in t track by $index">{{ x }}</td>
		</tr>
	      </table>
	      <button class="btn btn-primary"
		      ng-click="saveIt()">
		Save
	      </button>
	    </div>
	  </div>
	</div>
      </div>
      <!-- Modal -->
      <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
	  <div class="modal-content">
	    <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
              <h4 class="modal-title" id="myModalLabel">SpendPlan Help</h4>
	    </div>
	    <div class="modal-body" style="max-height:500px;overflow-y:auto">
              <h2>About SpendPlan</h2>
	      <p>
		SpendPlan helps you keep track of your finances.  It's kind of like Mint, Quicken, 
		Microsoft Money, your "Family Finances" spreadsheet, or your checkbook ledger, 
		except SpendPlan is better.  SpendPlan uses your Dropbox account, which means:
	      </p>
	      <ol>
		<li>
		  Your records sync automatically and immediately between devices.
		</li>
		<li>
		  Your records are private; you're the only person who has access to them&ndash;
		  no advertisements.  (Technically speaking, Dropbox has access to your records.)
		</li>
	      </ol>
	      <h2>How It Works</h2>
	      <ol>
		<li>
		  Add your accounts&ndash;bank accounts, credit cards, etc.  It's a
		  good idea to make account names unique, so you don't get confused later on.
		  Make sure to choose a currency for each account; US Dollars is the default, 
		  but GB Pounds Sterling is also supported.  For GBP accounts, currency conversions 
		  are shown using the end-of-day rate for the date of the transaction; when a transaction
		  involves exchanging currency, this shows whether you got a good rate.  If you would like 
		  support for additional currencies, please <a href="mailto:rothlmar@gmail.com?subject=SpendPlan%20Currency%20Support">contact the developer</a>.
		</li>
		<li>
		  Add transactions, just as they show up on your online banking or paper 
		  account statement.  A category is required, e.g. <strong>Groceries</strong>, 
		  <strong>Entertainment</strong>, or <strong>Travel</strong>. Tags are optional, 
		  if you use them, they're usually more specific than a category, e.g. <em>Christmas</em> 
		  or <em>Birthday</em> in the <strong>Gifts</strong> category.   You can add multiple 
		  tags as comma-separated list.
		</li>
		<li>
		  After you've added a transaction, you can change the category, tags, or description; just 
		  double click on the thing you want to change.  The date, amount, and account can't be
		  changed.  If you've made a mistake in one of those, delete the transaction and re-enter it.
		</li>
		<li>
		  Filters help you gain insight into your past behavior.  The transaction filters can show
		  you all of your transactions in a given category or at a given store (assuming you put that
		  in the note), and the date filters under <strong>Categories</strong> show how
		  much you earned spent over a specified time period.  The date filter in 
		  <strong>Accounts</strong> will eventually show you your account balance on the selected
		  date, but hasn't yet been set up.  Likewise with transaction filtering by tags.
		</li>
	      </ol>
	      <h2>How It's Different</h2>
	      <ul>
		<li>
		  In SpendPlan there's no distinction between account types.  You can make your own 
		  decisions about how to set things up, but I recommend that all expenditures be registered
		  as negative numbers.  That's not how they look on your credit card statement, which
		  is a sneaky trick the credit card companies use to make you think spending a lot of
		  money is good!
		</li>
		<li>
		  SpendPlan doesn't treat money transferred from one account to another specially.  When you 
		  pay a credit card from your checking account, you have to enter two transactions; one as
		  a debit, the other as a credit.
		</li>
	      </ul>
	      <h2>Where It's Going</h2>
	      <ul>
		<li>
		  SpendPlan should live up to its promise of helping you plan your spending.  It isn't
		  quite there yet.  I have a vision of being able to set goals or targets, which would
		  be tied to tags and categories.  They could be ongoing, e.g. monthly grocery budget, or
		  time-limited, e.g. this year's Christmas budget.  I haven't yet finalized my vision of
		  how this will work; stay tuned.
		</li>
		<li>
		  The way SpendPlan is set up, it can in theory read files that you put in your Dropbox.
		  Eventually, I pan to make it so you can download an account statement as a CSV file, save it
		  to Dropbox, then import the transactions in that file directly to SpendPlan.  Don't
		  expect this to happen anytime soon.
		</li>
		<li>
		  SpendPlan is in active development.  If you're reading this, you're an alpha tester, 
		  so you know that some things don't work the way you expect, or at all. Please request 
		  any features that would be helpful to you.
		</li>
	      </ul>

	      <div style="text-align:right">
		<span class="glyphicon glyphicon-tower"></span>
		<span class="glyphicon glyphicon-tree-deciduous"></span>
	      </div>
	    </div>
	    <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	    </div>
	  </div><!-- /.modal-content -->
	</div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-46906608-1', 'spendplan-rothlmar.rhcloud.com');
      ga('send', 'pageview');
      
    </script>
  </body>
</html>
